var d3 = require('d3'), 
jsdom = require('jsdom'),
dataviz='<div id="dataviz-container"></div>';
jsdom.env(
	'<div id="dataviz-container"></div>',
	function(errors, window) {
	// this callback function pre-renders the dataviz inside the html document, then export result into a static file

		var el = window.document.querySelector('#dataviz-container')
			, circleId = 'a2324';  // say, this value was dynamically retrieved from some database

		// generate the dataviz
		d3.select(el)
			.append('svg:svg')
				.attr('width', 600)
				.attr('height', 300)
				.append('circle')
					.attr('cx', 300)
					.attr('cy', 150)
					.attr('r', 30)
					.attr('fill', '#26963c')
					.attr('id', circleId); // say, this value was dynamically retrieved from some database
		// save result in an html file, we could also keep it in memory, or export the interesting fragment into a database for later use
		var svgsrc = window.document.querySelector('#dataviz-container').innerHTML;
		logger.info(svgsrc);
		res.render('barchart.ejs', {objectResult: svgsrc});
	}
);